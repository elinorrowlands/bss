<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>BSS: Ripples</title>

  <link rel="stylesheet" href="../../style.css">
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="./style_circles.css">
  <style>
    body{
        overflow:hidden;
        transition:all 1s ease;
        height:100vh;
        width:100vw;
    }
    
    canvas{
      -webkit-user-select: none; /* Safari */
      user-select:none;
    }
    
    #water-ripples-title{
      display:none;
    }
    
    #painting,#centeredCircle,.canBG{
      -webkit-user-select: none; /* Safari */
      user-select:none;
      width:100%; 
      position:absolute;
      margin:0;
      display:block;
      transform-origin:center;
      z-index:100;
      @media (max-width: 600px) {
       width:100%; 
       height:100%;
      
        top:0;
        transform-origin:center;
      }
    }
    
    .canBG{
        opacity:0.5;
        width:60vh;
        height:60vh;
        top:0px;
        left:0px;
        bottom:0px;
        right:0px;
        margin:auto;
        transition:all 1.5s ease;
      }
      
      #can__bg{
        transition:all 1s ease;
      }
      
  </style>
</head>

<body>
  <div id="canvas"></div>
  <div id="content">
    <div id="water-ripples">
      <div id="water-ripples-title">
        <h1 style="user-select:none;pointer-events:none;"></h1>
      </div>
      
      <svg id="centeredCircle" width="100%" height="100%" viewBox="0 0 100 100">
        <circle id="waterCircle" cx="50" cy="50" r="40" stroke="none" stroke-width="4" fill="darkblue" style="opacity:0.4;"></circle>
        <circle id="echoCircle" cx="50" cy="50" r="40" stroke="none" stroke-width="4" fill="darkblue" style="opacity:0.4;"></circle>
        <circle id="echoCircle2" cx="50" cy="50" r="40" stroke="none" stroke-width="4" fill="darkblue" style="opacity:0.4;"></circle>
      </svg>
      <img src="water_frame_0.png" alt="water" crossorigin="" data-sampler="planeTexture">
      
    </div>
  </div>
  <img id="can__bg" src="can/can_bg_900.svg" alt="background" class="canBG">
  
  <svg id="can__0__guide" class="canBG" xmlns:xlink="http://www.w3.org/1999/xlink"  xmlns="http://www.w3.org/2000/svg" viewBox="0,0,524,524" style="enable-background:new 0 0 524 524;" version="1.1">
  <defs/>
  <g id="layer0">
  <path class="visual guide" d="M139.964,420.171C151.77,423.49 162.479,415.023 165.898,417.142C173.503,424.657 186.362,415.144 193.988,415.174C206.653,416.9 213.417,414.634 221.068,410.161C228.9,408.369 232.909,401.389 239.08,399.155C244.417,394.867 247.994,388.585 248.174,383.008C252.735,380.864 251.319,366.696 250.167,362.95C251.475,351.503 248.929,339.921 252.166,330.054C255.183,319.967 253.697,315.246 252.172,304.972C249.029,300.891 245.379,295.685 244.165,290.944C243.857,290.768 241.225,290.836 239.416,290.219C237.606,289.601 236.597,288.454 239.144,285.099C236.124,275.766 222.252,266.923 209.925,268.842C198.603,283.091 203.566,262.755 189.948,264.833C188.151,265.773 186.116,268.613 185.062,268.837C184.054,265.718 184.749,263.679 185.82,262.669C186.891,261.659 188.274,262.016 189,264.175C187.27,259.044 184.747,260.526 182.605,262.699C180.464,264.872 178.874,267.524 178.171,263.964C176.615,261.224 175.286,262.954 174.302,265.27C173.318,267.586 172.458,270.357 170.951,269.832C168.478,274.562 161.701,278.759 155.169,279.678C148.636,280.597 142.564,278.357 141.168,269.952C127.12,267.606 113.209,274.365 100.97,271.828C104.031,273.828 103.069,275.298 101.097,276.275C99.1245,277.252 96.1648,277.734 94.9932,277.825L93.1747,277C87.1245,272.334 81.5679,260.542 70.9735,269.827C73.2528,268.748 73.7625,270.05 73.8962,271.501C74.0299,272.953 73.6883,274.848 73.8741,275.121C76.2192,275.977 75.6096,277.247 74.215,278.542C72.8203,279.837 70.8477,280.882 70.0811,280.845C70.0533,280.155 69.4033,279.582 68.819,279.082C68.2347,278.582 67.7032,278.47 68.0682,278.161L65.1747,278C65.3144,276.987 63.7244,276.784 62.481,276.773C61.2376,276.762 60.1509,277.117 60.9848,276.174C56.0803,284.629 54.4805,308.255 52.8374,313.936C54.6355,314.86 54.8905,316.168 54.4426,317.218C53.9946,318.268 52.9425,318.962 51.9363,318.837C54.3929,323.935 47.5888,333.433 48.8422,336.075C46.9501,340.029 52.8388,346.934 48.8909,348.864C49.3621,354.97 51.9719,362.98 51.8254,372.995C56.1001,372.825 58.7368,381.526 64.9906,381.174C67.4986,381.592 66.7995,384.012 65.6487,386.739C64.4979,389.466 62.7319,392.349 62.8271,393.025C71.4002,423.994 109.158,415.678 139.964,420.171ZM184.973,398.827L182.175,400C182.4,398.134 174.967,400.358 177.135,395.111L176,393L175,393C172.932,393 168.563,392.825 168,392.825L166.175,391C164.326,389.174 166.172,389.037 168.771,389.088C171.37,389.138 174.544,389.551 174.996,389.175C177.685,391.638 183.111,392.86 182.831,396.957C183.466,396.624 185.259,396.954 186.196,397.35C187.133,397.745 187.357,398.078 184.973,398.827ZM160.975,388.173C154.527,390.129 142.044,388.251 132.994,388.825C131.558,388.825 127.916,389.173 128.027,389.173C122.646,387.403 123.768,385.749 126.547,385.239C129.326,384.73 133.605,385.31 134.87,388.117C142.229,388.117 152.377,388.173 160.975,388.173ZM194.913,325.849L193.175,327C190.664,323.91 182.654,323.423 183.173,316.024C181.427,316.024 177.218,315.825 177,315.825L176.175,317C175.489,315.442 173.952,313.712 173.486,312.518C173.019,311.324 173.52,310.826 177.071,311.16C177.512,309.229 179.672,309.101 181.823,309.64C183.975,310.178 185.872,311.211 185.826,311.987C187.512,313.152 191.095,315.308 193.566,317.776C196.036,320.244 197.479,322.887 194.913,325.849Z" fill="#050503"/>
  <path class="visual guide" d="M181.83,399.959L185.175,399C187.559,398.251 187.269,397.424 186.332,397.028C185.395,396.632 183.591,396.498 182.956,396.831L181.175,397C180.738,395.691 177.331,394.642 176.894,394.861C174.726,400.108 182.056,398.093 181.83,399.959Z" fill="#291E0B"/>
  <path class="visual guide" d="M180.855,397.097L183.175,397C183.455,392.903 177.762,391.304 175.073,388.841L175,390L176,393L177.175,395C177.612,394.781 180.418,395.788 180.855,397.097Z" fill="#423B1D"/>
  <path class="visual guide" d="M168,393C168.563,393 173.009,393.157 175.077,393.157C175.38,391.315 173.362,390.834 171.441,390.844C169.52,390.855 167.768,391.294 168.148,390.093L166,391L168,393Z" fill="#282819"/>
  <path class="visual guide" d="M174.834,392.945L176,393L175,390C172.932,390 168.488,389.842 167.925,389.842C167.545,391.043 169.522,391.204 171.443,391.194C173.364,391.183 175.137,391.104 174.834,392.945Z" fill="#302F1D"/>
  <path class="visual guide" d="M165.923,391.157L168,390C168.563,390 172.932,390.175 175,390.175L174.825,389C174.373,389.376 171.377,388.789 168.778,388.739C166.179,388.688 164.074,389.331 165.923,391.157Z" fill="#30301E"/>
  <path class="visual guide" d="M127.972,389.172C129.408,389.172 133.111,388.825 133,388.825L135.175,388C133.909,385.193 129.263,384.386 126.484,384.896C123.705,385.405 122.591,387.403 127.972,389.172Z" fill="#1E231A"/>
  <path class="visual guide" d="M133.175,389C142.225,388.426 154.578,390.129 161.026,388.173C152.428,388.173 142.359,387.825 135,387.825L133.175,389Z" fill="#24261D"/>
  <path class="visual guide" d="M105.865,374.111C107.191,374.057 110.411,374.27 112.746,374.233C115.08,374.196 116.747,373.644 115.082,372.846C114.302,372.354 111.629,371.698 109.401,371.629C107.173,371.56 105.172,372.341 105.865,374.111Z" fill="#1F2116"/>
  <path class="visual guide" d="M164.944,365.165C166.175,365.254 167.877,364.162 168.828,363.118C169.778,362.073 170.042,360.737 169.009,360.826C166.944,360.428 165.253,361.167 164.496,362.104C163.739,363.04 163.852,364.514 164.944,365.165Z" fill="#C7BC90"/>
  <path class="visual guide" d="M183.853,362.094C186.675,362.935 187.839,362.133 187.804,361.197C187.77,360.261 186.768,358.944 186.084,358.847C185.112,356.156 184.243,356.742 183.928,358.027C183.614,359.312 183.622,361.543 183.853,362.094Z" fill="#1D1C10"/>
  <path class="visual guide" d="M89.0598,357.164C92.073,357.722 92.2469,356.609 91.5408,355.674C90.8347,354.738 89.176,353.64 88.9873,353.826C86.9416,352.301 86.7003,353.38 87.166,354.556C87.6316,355.732 88.8767,357.344 89.0598,357.164Z" fill="#323626"/>
  <path class="visual guide" d="M236.885,354.131C238.198,354.245 240.231,354.405 241.597,354.187C242.964,353.968 243.895,353.107 243.115,351.869C241.802,351.755 239.769,351.595 238.403,351.813C237.036,352.032 236.105,352.893 236.885,354.131Z" fill="#31301B"/>
  <path class="visual guide" d="M203.825,336C205.244,335.9 208.705,336.254 211.244,336.243C213.782,336.233 215.604,335.687 214.032,334.828C212.55,335.057 210.022,334.802 207.892,334.744C205.763,334.687 203.824,334.997 203.825,336Z" fill="#161209"/>
  <path class="visual guide" d="M204.027,336.173C204.026,335.17 205.753,335.036 207.883,335.094C210.012,335.152 212.605,335.379 214.088,335.151C214.06,334.461 213.403,333.582 212.819,333.082C212.235,332.582 211.703,332.47 212.068,332.161L209.175,333C209.988,331.468 208.987,330.858 207.988,330.772C206.989,330.687 205.901,331.28 206.083,331.154C204.53,330.635 203.468,331.242 203.202,332.397C202.936,333.552 203.409,335.273 204.027,336.173Z" fill="#29220D"/>
  <path class="visual guide" d="M120.858,334.102C122.808,334.672 125.602,334.384 127.283,333.693C128.963,333.002 129.767,331.659 128.095,330.853C126.677,329.354 124.471,329.51 122.937,330.342C121.403,331.173 120.303,332.928 120.858,334.102Z" fill="#3C3521"/>
  <path class="visual guide" d="M208.933,332.839L212.175,332C214.499,329.567 212.493,328.655 210.25,328.769C208.008,328.883 205.293,330.187 205.938,331.163C207.259,330.56 208.099,330.877 208.6,331.462C209.1,332.046 209.255,332.572 208.933,332.839Z" fill="#4D4016"/>
  <path class="visual guide" d="M192.908,327.149L195.175,326C197.741,323.038 196.283,319.997 193.813,317.529C191.342,315.061 187.645,312.995 185.959,311.83C186.333,313.239 185.274,313.828 184.29,314.266C183.307,314.703 182.291,315.249 182.851,316.09C182.332,323.489 190.398,324.059 192.908,327.149Z" fill="#524523"/>
  <path class="visual guide" d="M51.845,319.081C52.8513,319.205 54.316,318.405 54.7639,317.355C55.2119,316.305 54.811,314.75 53.0129,313.826C51.7142,314.273 51.7546,318.772 51.845,319.081Z" fill="#7D6E50"/>
  <path class="visual guide" d="M175.869,317.115L177.175,316C177.175,314.564 176.825,310.889 176.825,311C173.275,310.667 172.694,311.452 173.16,312.645C173.626,313.839 175.183,315.558 175.869,317.115Z" fill="#7E662E"/>
  <path class="visual guide" d="M57.8639,315.89C59.5039,316.162 60.5642,315.137 60.9064,313.731C61.2487,312.325 61.1836,310.642 61.1746,309.994C58.8653,310.422 58.2756,315.024 57.8639,315.89Z" fill="#756447"/>
  <path class="visual guide" d="M177.175,316C177.393,316 181.322,316.161 183.067,316.161C182.508,315.32 183.449,315.023 184.432,314.585C185.416,314.147 186.543,313.364 186.169,311.956C186.215,311.18 184.06,309.839 181.908,309.301C179.757,308.762 177.271,309.031 176.83,310.962C176.83,312.398 177.175,316.111 177.175,316Z" fill="#46381A"/>
  <path class="visual guide" d="M230.883,305.129C232.857,305.462 234.577,305.362 235.344,304.967C236.111,304.571 236.159,303.618 235.116,302.869C234.251,301.481 232.795,301.612 231.892,302.279C230.99,302.947 230.408,304.411 230.883,305.129Z" fill="#6B5C33"/>
  <path class="visual guide" d="M154.976,303.173L158,302L158,299L157.175,299C155.164,298.631 154.11,299.557 154.011,300.62C153.911,301.684 154.566,303.058 154.976,303.173Z" fill="#877D5E"/>
  <path class="visual guide" d="M157.825,302C158.743,302.045 160.453,302.294 161.609,302.195C162.764,302.096 163.681,301.545 163.14,300.896C162.631,299.336 158.849,298.512 157.969,298.828L157.825,302Z" fill="#A49771"/>
  <path class="visual guide" d="M162.926,301.158C165.815,298.613 164.401,296.101 162.159,295.395C159.917,294.688 156.745,295.636 156.826,299.008L158.175,299C159.055,298.684 162.417,299.599 162.926,301.158Z" fill="#7C724C"/>
  <path class="visual guide" d="M199,291.175C199.588,289.363 203.514,288.204 203.162,286.934C199.429,285.6 198.547,289.803 199,291.175Z" fill="#958C64"/>
  <path class="visual guide" d="M148.987,287.174C151.9,287.306 153.919,286.43 154.495,285.5C155.071,284.57 154.288,283.253 152.071,282.841C150.646,281.447 148.59,282.395 147.649,283.689C146.709,284.984 146.8,286.958 148.987,287.174Z" fill="#524726"/>
  <path class="visual guide" d="M69.9276,280.841C70.6942,280.878 73.0581,280.093 74.4527,278.798C75.8473,277.503 76.3765,275.684 74.0314,274.828L71.8253,275C71.4266,275.635 70.2798,275.822 69.2498,276.213C68.2198,276.604 67.3309,277.288 67.8497,278.089C67.8774,278.779 68.5967,279.418 69.181,279.918C69.7653,280.418 70.2926,280.532 69.9276,280.841Z" fill="#A8A27B"/>
  <path class="visual guide" d="M64.8316,277.954L68.1747,278C67.6559,277.199 68.3438,276.93 69.3738,276.539C70.4038,276.148 71.71,275.772 72.1088,275.137L69,275L70,272L69,272L67,273L63.8253,274C63.9523,274.845 63.3625,275.269 62.6086,275.599C61.8547,275.929 61.1243,275.993 61.013,275.826C60.1791,276.769 61.2344,277.111 62.4778,277.122C63.7212,277.134 64.9713,276.941 64.8316,277.954Z" fill="#B1AA83"/>
  <path class="visual guide" d="M95.1747,278C96.3463,277.909 99.2796,277.565 101.252,276.588C103.224,275.611 104.115,273.834 101.054,271.834C99.3086,271.834 95.2181,271.825 95,271.825L93.8253,273C94.7221,275.333 92.5195,276.855 92.9397,277.164L95.1747,278Z" fill="#796938"/>
  <path class="visual guide" d="M60.9708,275.828C62.054,276.193 63.0077,275.993 63.5077,275.408C64.0078,274.824 64.1744,273.879 64.091,273.851C63.1421,272.39 62.2454,272.954 61.7817,273.819C61.3179,274.683 61.167,275.824 60.9708,275.828Z" fill="#050503"/>
  <path class="visual guide" d="M210.866,276.112C212.626,276.838 214.105,276.446 214.772,275.692C215.438,274.938 215.562,273.597 215.134,272.888C213.374,272.162 211.895,272.554 211.228,273.308C210.562,274.062 210.438,275.403 210.866,276.112Z" fill="#A39E79"/>
  <path class="visual guide" d="M69,275L72,275L74.1747,275C73.9889,274.727 74.3778,272.921 74.2441,271.469C74.1103,270.018 73.2391,268.751 70.9598,269.83L70,271L70,272L69,275Z" fill="#B2AB83"/>
  <path class="visual guide" d="M67,273L68,272L67,273Z" fill="#050503"/>
  <path class="visual guide" d="M94,273L95,272L94,273Z" fill="#050503"/>
  <path class="visual guide" d="M69,272L70,272L70,271L69,272Z" fill="#050503"/>
  <path class="visual guide" d="M94.9748,272.173C96.237,272.483 98.0425,272.333 99.095,272.057C100.148,271.781 100.559,271.056 99.0863,270.848C98.873,269.566 97.5358,269.806 96.5058,270.372C95.4758,270.938 94.6415,272.155 94.9748,272.173Z" fill="#050503"/>
  <path class="visual guide" d="M70,271L71,270L70,271Z" fill="#050503"/>
  <path class="visual guide" d="M184.865,269.111C185.92,268.887 188.247,266.109 190.044,265.169L189,265L189.175,264C188.449,261.841 186.651,261.405 185.58,262.415C184.51,263.425 183.858,265.992 184.865,269.111Z" fill="#8B7A3B"/>
  <path class="visual guide" d="M189,265L190,265L189,264L189,265Z" fill="#050503"/>
  </g>
  </svg>
  <img id="can__1__guide" src="can/can_1.svg" class="canBG" alt="can">
  <img id="can__0__ghost" src="can/can_0.png" class="canBG" alt="can">
  <img id="can__1__ghost" src="can/can_1.png" class="canBG" alt="can">
  <img id="can__0" src="can/can_0.png" class="canBG" alt="can">
  <img id="can__1" src="can/can_1.png" class="canBG" alt="can">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>
  <script src="https://www.curtainsjs.com/build/curtains.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/13.4.9/Tone.min.js"></script>
  <script src="../../main.js"></script>
  <script src="./script.js" type="module" defer></script>
  <script src="./interact.js" defer></script>
  <script src="./touch.js" defer></script>

  <script>
    function checkLoaded(name) {
        const interval = 100;
        window.setTimeout(function() {
            if (window[name]) {
                window[name]();
            } else {
                checkLoaded(name);
            }
        }, interval);
    }

    const container = 'body';

    const sounds = {
        loop: new Tone.Player("../../loops/rusty_can_0.mp3"),
        loop2: new Tone.Player("../../loops/rusty_can_1.mp3"),
        loop3: new Tone.Player("../../loops/rusty_can_1.mp3"),
        meter: new Tone.Meter(),
        filter: new Tone.Filter(200, "lowpass"),
        hpf: new Tone.Filter(400, "highpass"),
        echo: new Tone.FeedbackDelay("2n", 0.5).toMaster(),
        echoMeter: new Tone.Meter()
    }

    let moused = false;
    
    sounds.echo.wet.value = 1;
    sounds.loop.volume.value=-12;
    sounds.loop.connect(sounds.filter);
    sounds.filter.Q.value = 0;
    sounds.filter.toMaster();
    sounds.filter.connect(sounds.hpf);
    sounds.hpf.connect(sounds.echo);
    sounds.echo.connect(sounds.echoMeter);
    sounds.filter.connect(sounds.meter);
    
    function setBGAnimation(){
        let i = 0, count = 0;
        setInterval( () => {
            i = i === 0 ? 1 : 0;
            count++;
            
            if(moused){
                let hue = Math.floor(count/30%100);
                $('#can__bg').css('opacity',0.1 + Tone.dbToGain(sounds.meter.getLevel())*2);
                document.body.style.filter = `hue-rotate(${Math.floor(hue)}deg) brightness(100%)`;
                // $('.canBG.ghost').css('filter',`hue-rotate(${Math.floor(hue)}deg) grayscale(${Tone.dbToGain(sounds.meter.getLevel())*1000}%)`);
                // $('.canBG.ghost').css({opacity:0.9 + Tone.dbToGain(sounds.meter.getLevel())});
                document.querySelectorAll('.canBG.ghost').forEach((el) => {
                    el.style.filter = `hue-rotate(${Math.floor(hue)}deg) grayscale(${Tone.dbToGain(sounds.meter.getLevel())*1000}%)`;
                    el.style.transform = `scale(${0.9 + Tone.dbToGain(sounds.meter.getLevel())*1})`;
                    el.style.opacity = 0.9 + Tone.dbToGain(sounds.meter.getLevel());
                })
                // console.log(0.9 + Tone.dbToGain(sounds.meter.getLevel()))
            } else {
                $('#can__bg').css('opacity',0.5 + Tone.dbToGain(sounds.meter.getLevel()));
                document.body.style.filter = `hue-rotate(0deg)`;
                $('.canBG.ghost').css('opacity',0.4 + Tone.dbToGain(sounds.meter.getLevel()));
                $('.canBG.ghost').css('opacity',0);
            }
           
            $('#waterCircle').css('opacity',0.1 + Tone.dbToGain(sounds.meter.getLevel()));
            $('#waterCircle').css('transform', `scale(${0.1 + Tone.dbToGain(sounds.meter.getLevel())*4})`);
            $('#can__0').css('transform', `scale(${0.9 + Tone.dbToGain(sounds.meter.getLevel())*1})`);
            $('#can__bg').css('transform', `scale(${0.9 + Tone.dbToGain(sounds.meter.getLevel())*1})`);
            $('#echoCircle').css('transform', `scale(${0 + Tone.dbToGain(sounds.echoMeter.getLevel())*6})`);
            $('#can__1').css('transform', `scale(${0.9 + Tone.dbToGain(sounds.echoMeter.getLevel())*1.3})`);
            $('#echoCircle2').css('transform', `scale(${0 + Tone.dbToGain(sounds.echoMeter.getLevel())*10})`);
            
        }, 30)
    }
    
    setBGAnimation();
    
    let started = false;
    
    window.addEventListener('mousedown', (e) => {
      Tone.start();
      sounds.loop.loop = true;
      if(!started){
          sounds.loop.start();    
          started = true;
      }
     sounds.filter.frequency.rampTo(1000, 1);
     moused = true;   

    });
    
    window.addEventListener('mouseup',(e) => {
        sounds.filter.frequency.rampTo(200, 1);
        moused=false;
    });
    
    Tone.start();
    
    let loadScript = loadingIndicator.init();
    checkLoaded('addBackButton');
    
    
  </script>
</body>
</html>